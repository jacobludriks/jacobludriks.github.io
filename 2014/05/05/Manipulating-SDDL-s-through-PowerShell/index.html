<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Manipulating SDDL&#39;s through PowerShell - Jacob Ludriks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I manage security for service accounts through access with least privilege. Monitoring with PRTG however means that most of the WMI sensors need local Administrator access, which I’m not too happy abo">
<meta property="og:type" content="article">
<meta property="og:title" content="Manipulating SDDL's through PowerShell">
<meta property="og:url" content="http://jacob.ludriks.com/2014/05/05/Manipulating-SDDL-s-through-PowerShell/index.html">
<meta property="og:site_name" content="Jacob Ludriks">
<meta property="og:description" content="I manage security for service accounts through access with least privilege. Monitoring with PRTG however means that most of the WMI sensors need local Administrator access, which I’m not too happy abo">
<meta property="og:updated_time" content="2016-05-12T06:14:38.015Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Manipulating SDDL's through PowerShell">
<meta name="twitter:description" content="I manage security for service accounts through access with least privilege. Monitoring with PRTG however means that most of the WMI sensors need local Administrator access, which I’m not too happy abo">
  
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jacob.ludriks.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-Manipulating-SDDL-s-through-PowerShell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Manipulating SDDL&#39;s through PowerShell
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2014/05/05/Manipulating-SDDL-s-through-PowerShell/" class="article-date">
  <time datetime="2014-05-05T02:43:00.000Z" itemprop="datePublished">2014-05-05</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>I manage security for service accounts through access with least privilege. Monitoring with PRTG however means that most of the WMI sensors need local Administrator access, which I’m not too happy about. One such situation is if you need to access the state of running services. To get around this, use the script below.</p>
<script src="https://gist.github.com/jacobludriks/6306afa2ad7949912d4f.js"></script>


<p>One example:</p>
<p><code>sddlset.ps1 -Username &quot;domain\monitoring&quot; -Service w3svc -Rights Read -Computer webserver</code></p>
<p>This will then resolve the SID for the user, add it to the SDDL with necessary permissions and then spit out the result. To allow any access at all you will first need to give the user permissions on <code>scmanager</code>, so run <code>sddlset.ps1 -Username &quot;domain\monitoring&quot; -Service scmanager -Rights Read -Computer webserver</code>.</p>
<p><strong>Edit 12/02/2015</strong>: Added help function to script, added ability to perform remotely.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sddl/">sddl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/services/">services</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wmi/">wmi</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/05/05/Setting-WMI-permissions-for-PRTG/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          Setting WMI permissions for PRTG
        
      </div>
    </a>
  
  
    <a href="/2014/04/28/TokenMungingException-in-Exchange-OWA/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">TokenMungingException in Exchange OWA&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Jacob Ludriks&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>



<script src="/js/script.js"></script>
  </div>
</body>
</html>