<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Jacob Ludriks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Jacob Ludriks">
<meta property="og:url" content="http://jacob.ludriks.com/index.html">
<meta property="og:site_name" content="Jacob Ludriks">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jacob Ludriks">
  
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jacob.ludriks.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer">
      <article id="post-FreeBSD-Thin-Jails" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/07/FreeBSD-Thin-Jails/">FreeBSD Thin Jails</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/06/07/FreeBSD-Thin-Jails/" class="article-date">
  <time datetime="2017-06-07T01:01:40.000Z" itemprop="datePublished">2017-06-07</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently I built up a new storage server running FreeBSD. Initially I was going to go with FreeNAS like my old storage server, however the FreeNAS project is in a bit of flux at the moment and I thought this would be a good way to learn about the inner workings of FreeBSD. Part of this is segregating the applications running on the server in to “jails”. They are a form of OS-level virtualization, where each jail has its own files, processes and user accounts.</p>
<p>I was tempted to run a jail management tool such as ezjail, iocage or qjail, however configuring manually through jail.conf and the jail command seems to be quite easy once you wrap your head around it. This guide walks through building a base jail template that can easily be added as a layer to new jails. This approach is great as you only need to update one layer when OS-level updates get released.</p>
<p>First, enable jails in your OS.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sysrc jail_enable=YES</div></pre></td></tr></table></figure>
<p>Create a dataset for the jails and thinjails</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">zfs create -o mountpoint=/usr/local/jails zroot/jails</div><div class="line">zfs create zroot/jails/thinjails</div></pre></td></tr></table></figure>
<p>Then, create another dataset for the 11.0-RELEASE files</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zfs create -p zroot/jails/releases/11.0-RELEASE</div></pre></td></tr></table></figure>
<p>Download and extract all required binaries from a FreeBSD mirror. I chose Optus Australia as that is my closest/fastest mirror.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fetch ftp://ftp4.au.freebsd.org/pub/FreeBSD/releases/amd64/amd64/11.0-RELEASE/base.txz -o /tmp/base.txz</div><div class="line">fetch ftp://ftp4.au.freebsd.org/pub/FreeBSD/releases/amd64/amd64/11.0-RELEASE/lib32.txz -o /tmp/lib32.txz</div><div class="line">fetch ftp://ftp4.au.freebsd.org/pub/FreeBSD/releases/amd64/amd64/11.0-RELEASE/ports.txz -o /tmp/ports.txz</div><div class="line">tar -xvf /tmp/base.txz -C /usr/local/jails/releases/11.0-RELEASE</div><div class="line">tar -xvf /tmp/lib32.txz -C /usr/local/jails/releases/11.0-RELEASE</div><div class="line">tar -xvf /tmp/ports.txz -C /usr/local/jails/releases/11.0-RELEASE</div></pre></td></tr></table></figure>
<p>Update to latest patch level (p10 at the release of this blog post)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">env UNAME_r=11.0-RELEASE freebsd-update -b /usr/local/jails/releases/11.0-RELEASE fetch install</div></pre></td></tr></table></figure>
<p>Verify nothing was damaged in transit (this is more paranoia than anything…)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">env UNAME_r=11.0-RELEASE freebsd-update -b /usr/local/jails/releases/11.0-RELEASE IDS</div></pre></td></tr></table></figure>
<p>Add local timezone and DNS servers to files</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp /etc/resolv.conf /usr/local/jails/releases/11.0-RELEASE/etc/resolv.conf</div><div class="line">cp /etc/localtime /usr/local/jails/releases/11.0-RELEASE/etc/localtime</div></pre></td></tr></table></figure>
<p>Snapshot the release. Since mine is patch level 10, I chose the name <code>p10</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zfs snapshot zroot/jails/releases/11.0-RELEASE@p10</div></pre></td></tr></table></figure>
<p>Clone the <code>11.0-RELEASE</code> snapshot to a new base jail. This will be the first layer in future jails.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">zfs create zroot/jails/templates</div><div class="line">zfs clone zroot/jails/releases/11.0-RELEASE@p10 zroot/jails/templates/base-11.0-RELEASE</div></pre></td></tr></table></figure>
<p>Create a skeleton dataset that will be used for jail-specific files</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zfs create -p zroot/jails/templates/skeleton-11.0-RELEASE</div></pre></td></tr></table></figure>
<p>Create folders in skeleton dataset</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir -p /usr/local/jails/templates/skeleton-11.0-RELEASE/usr/ports/distfiles</div><div class="line">mkdir -p /usr/local/jails/templates/skeleton-11.0-RELEASE/home</div><div class="line">mkdir -p /usr/local/jails/templates/skeleton-11.0-RELEASE/portsbuild</div></pre></td></tr></table></figure>
<p>Move folders from the base jail layer to the skeleton jail layer. These are jail-specific directories.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mv /usr/local/jails/templates/base-11.0-RELEASE/etc /usr/local/jails/templates/skeleton-11.0-RELEASE/etc</div><div class="line">mv /usr/local/jails/templates/base-11.0-RELEASE/usr/local /usr/local/jails/templates/skeleton-11.0-RELEASE/usr/local</div><div class="line">mv /usr/local/jails/templates/base-11.0-RELEASE/tmp /usr/local/jails/templates/skeleton-11.0-RELEASE/tmp</div><div class="line">mv /usr/local/jails/templates/base-11.0-RELEASE/var /usr/local/jails/templates/skeleton-11.0-RELEASE/var</div><div class="line">mv /usr/local/jails/templates/base-11.0-RELEASE/root /usr/local/jails/templates/skeleton-11.0-RELEASE/root</div></pre></td></tr></table></figure>
<p>For some reason <code>/var/empty</code> still remained when I moved the folders, so I had to remove it manually.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chflags 0 /usr/local/jails/templates/base-11.0-RELEASE/var/empty</div><div class="line">rm -r /usr/local/jails/templates/base-11.0-RELEASE/var</div></pre></td></tr></table></figure>
<p>Symlink the directories to the skeleton layer. Make sure you are in <code>/usr/local/jails/templates/base-11.0-RELEASE/</code> folder before running the commands, as the paths are all relative.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/jails/templates/base-11.0-RELEASE</div><div class="line">mkdir skeleton</div><div class="line">ln -s skeleton/etc etc</div><div class="line">ln -s skeleton/home home</div><div class="line">ln -s skeleton/root root</div><div class="line">ln -s ../skeleton/usr/local usr/local</div><div class="line">ln -s ../../skeleton/usr/ports/distfiles usr/ports/distfiles</div><div class="line">ln -s skeleton/tmp tmp</div><div class="line">ln -s skeleton/var var</div></pre></td></tr></table></figure>
<p>Update the ports make configuration to build in the non-default directory</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &quot;WRKDIRPREFIX?=  /skeleton/portbuild&quot; &gt;&gt; /usr/local/jails/templates/skeleton-11.0-RELEASE/etc/make.conf</div></pre></td></tr></table></figure>
<p>Snapshot the skeleton so we can clone it in each jail</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zfs snapshot zroot/jails/templates/skeleton-11.0-RELEASE@skeleton</div></pre></td></tr></table></figure>
<p>Create /etc/jail.conf with the below text. I have added comments to explain each section.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"># The interface that the jails will interface with on the host</div><div class="line">interface = &quot;igb0&quot;;</div><div class="line"></div><div class="line"># The name of each jail. $name is a placeholder. In the example below, $name would be jail1</div><div class="line">host.hostname = &quot;$name.domain.local&quot;;</div><div class="line"></div><div class="line"># The path to the jail files</div><div class="line">path = &quot;/usr/local/jails/$name&quot;;</div><div class="line"></div><div class="line"># The IP address of the jail. In the example below, it would be 10.1.1.40</div><div class="line">ip4.addr = 10.1.1.$ip;</div><div class="line"></div><div class="line"># The fstab file for the jail. This resolves to jail1.fstab in the example.</div><div class="line">mount.fstab = &quot;/usr/local/jails/$name.fstab&quot;;</div><div class="line"></div><div class="line"># Common functions for all jails</div><div class="line">exec.start = &quot;/bin/sh /etc/rc&quot;;</div><div class="line">exec.stop = &quot;/bin/sh /etc/rc.shutdown&quot;;</div><div class="line">exec.clean;</div><div class="line">mount.devfs;</div><div class="line"></div><div class="line"># jail1 specific configuration</div><div class="line">jail1 &#123;</div><div class="line">        $ip = 40;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Done! We now have the components to create many thin jails. Now we will create our first thin jail off this template.</p>
<h2 id="Creating-a-thin-jail"><a href="#Creating-a-thin-jail" class="headerlink" title="Creating a thin jail"></a>Creating a thin jail</h2><p>First, clone the skeleton files for the new jail, and then set the hostname</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">zfs clone zroot/jails/templates/skeleton-11.0-RELEASE@skeleton zroot/jails/thinjails/jail1</div><div class="line">echo hostname=\&quot;jail1\&quot; &gt; /usr/local/jails/thinjails/jail1/etc/rc.conf</div></pre></td></tr></table></figure>
<p>Create folder where the layers for the jail will be mounted</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /usr/local/jails/jail1</div></pre></td></tr></table></figure>
<p>Create fstab at <code>/usr/local/jails/jail1.fstab</code> . The first layer is the base, mounted as read-only. The next is the skeleton we cloned, mounted as read-write.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/usr/local/jails/templates/base-11.0-RELEASE    /usr/local/jails/jail1/  nullfs  ro      0       0</div><div class="line">/usr/local/jails/thinjails/jail1 /usr/local/jails/jail1/skeleton  nullfs  rw      0       0</div></pre></td></tr></table></figure>
<p>Create and start jail “jail1”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jail -c jail1</div></pre></td></tr></table></figure>
<p>Add jail to auto-start on boot in <code>/etc/rc.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jail_list=&quot;jail1&quot;</div></pre></td></tr></table></figure>
<p>For each new jail, just follow the process:</p>
<ol>
<li>Add config to <code>/etc/jail.conf</code></li>
<li>Clone skeleton to <code>/usr/local/jails/thinjails/&lt;jailname&gt;</code></li>
<li>Write hostname to <code>/etc/rc.conf</code> in new jail files</li>
<li>Create folder <code>/usr/local/jails/&lt;jailname&gt;</code> for new jail</li>
<li>Create fstab <code>/usr/local/jails/&lt;jailname&gt;.fstab</code> and populate with layer information</li>
<li>Create and start with <code>jail -c jailname</code></li>
</ol>
<p>Whenever we want to update all jails at once, shut down the jails and run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">env UNAME_r=11.0-RELEASE freebsd-update -b /usr/local/jails/templates/base-11.0-RELEASE fetch install</div><div class="line">portsnap -p /usr/local/jails/templates/base-11.0-RELEASE/usr/ports auto</div></pre></td></tr></table></figure>
<p>This will update the base to the latest patch level, and update to the latest ports tree.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/freebsd/">freebsd</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Foglight-SSL-Certificates" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/12/Foglight-SSL-Certificates/">Foglight SSL Certificates</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/05/12/Foglight-SSL-Certificates/" class="article-date">
  <time datetime="2016-05-12T01:40:44.000Z" itemprop="datePublished">2016-05-12</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Foglight for Virtualization 7.0 Standard uses Tomcat under the covers to serve the web interface. To replace the SSL certificate, follow the instructions below. I started with a password-protected PFX file that had the password <code>foglight</code>.</p>
<ol>
<li>Copy the PFX file to the server to the <code>/usr/local/tomcat/conf</code> directory</li>
<li>Run the following to convert the PFX in to a Java keystore file, entering <code>foglight</code> for all password prompts: <code>/usr/local/jre1.6.0_43/bin/keytool -importkeystore -srckeystore /usr/local/tomcat/conf/foglight.pfx -srcstoretype pkcs12 -destkeystore /usr/local/tomcat/conf/foglight.jks -deststoretype JKS</code></li>
<li>Open <code>/usr/local/tomcat/conf/server.xml</code> in your favourite editor</li>
<li><p>Replace the Connector section with SSL with the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;Connector server=&quot;VKernel&quot; port=&quot;443&quot; maxHttpHeaderSize=&quot;8192&quot;</div><div class="line">        maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot;</div><div class="line">        enableLookups=&quot;false&quot; disableUploadTimeout=&quot;true&quot;</div><div class="line">        acceptCount=&quot;100&quot; scheme=&quot;https&quot; secure=&quot;true&quot;</div><div class="line">        SSLEnabled=&quot;true&quot; keystoreFile=&quot;conf/foglight.jks&quot;</div><div class="line">        keystorePass=&quot;foglight&quot; clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot;</div><div class="line">        ciphers=&quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,</div><div class="line">        TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,</div><div class="line">        TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,</div><div class="line">        TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA&quot; /&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>Restart Tomcat with <code>service tomcat restart</code></p>
</li>
</ol>
<p>After a restart, the web interface will now be using the new certificate.</p>
<p>For reference, the username and password for the appliance is <code>vkernel/vkernel</code> and the <code>su</code> password is <code>password</code>.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/foglight/">foglight</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssl/">ssl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tomcat/">tomcat</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Password-expiry-notification" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/15/Password-expiry-notification/">Password expiry notification</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/15/Password-expiry-notification/" class="article-date">
  <time datetime="2016-02-15T01:48:00.000Z" itemprop="datePublished">2016-02-15</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Password policies are a good thing, however as users aren’t chained to their desks anymore they might not realize that their AD password is expiring. Here’s a script that you can run as a scheduled task that will notify users that their password is expiring.</p>
<script src="https://gist.github.com/jacobludriks/1d8bbfcfb8f36d86ea62.js"></script>

<p>It was roughly copied from a Reddit thread (<a href="https://www.reddit.com/r/sysadmin/comments/445qp5/those_of_you_who_are_emailing_people_to_warn_them/cznmxyq" target="_blank" rel="external">link</a>) however it had a few bugs relating to fine-grained password policies and was using .NET methods for a few things instead of Powershell cmdlets.</p>
<p>Hope it comes in useful for someone.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/">security</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Powershell-FTP-functions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/27/Powershell-FTP-functions/">Powershell FTP functions</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/27/Powershell-FTP-functions/" class="article-date">
  <time datetime="2016-01-27T06:13:00.000Z" itemprop="datePublished">2016-01-27</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>It turns out there’s a lot to getting Powershell to connect to FTP servers. Here’s two functions I’ve written that can list FTP contents and download files. Enjoy.</p>
<script src="https://gist.github.com/jacobludriks/18c4d9f964ec77098736.js"></script>
      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ftp/">ftp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/">windows</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Set-Permissions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/15/Set-Permissions/">Set-Permissions</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/15/Set-Permissions/" class="article-date">
  <time datetime="2016-01-15T01:04:00.000Z" itemprop="datePublished">2016-01-15</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Hee’s a basic script I created recently to set permissions on a file/folder. This can be integrated with other scripts quite nicely.</p>
<script src="https://gist.github.com/jacobludriks/2c51e0d2988fc73c8225.js"></script>

<p>Enjoy!</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Updating-ciphers-for-Foglight-for-Virtualization-Standard" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/Updating-ciphers-for-Foglight-for-Virtualization-Standard/">Updating ciphers for Foglight for Virtualization Standard</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/10/15/Updating-ciphers-for-Foglight-for-Virtualization-Standard/" class="article-date">
  <time datetime="2015-10-15T03:23:00.000Z" itemprop="datePublished">2015-10-15</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>As of v45, Chrome is now blocking HTTPS sites with weak Diffie-Hellman public keys. Whilst this is good for everyone, it does cause certain things to stop working. Our Foglight for Virtualization Standard instance stopped working with Chrome and had to be fixed. Although this applies for Foglight, it can be used for any Tomcat 7 instance.</p>
<ol>
<li>SSH in to the Foglight virtual machine. Default username is <code>vkernel</code> and password is <code>vkernel</code> also.</li>
<li>Change to root by typing <code>su -</code>. Default password is <code>password</code>.</li>
<li>Type <code>nano /usr/local/tomcat/conf/server.xml</code> to edit the Tomcat config file.</li>
<li>Under the HTTPS config section (starts with <code>&lt;Connector server=&quot;VKernel&quot; port=&quot;443&quot; maxHttpHeaderSize=&quot;8192&quot; ....</code>), you will find a cipher list like <code>ciphers=&quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA ....&quot;</code>. Replace this with: <code>ciphers=&quot;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA&quot;</code></li>
<li>Press <code>Ctrl + X</code> and then <code>y</code> to save the file.</li>
<li>Type <code>service tomcat stop</code> then <code>service tomcat start</code> to reload the config file</li>
</ol>
<p>You should now be able to access the site properly with Chrome v45+.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/foglight/">foglight</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssl/">ssl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tomcat/">tomcat</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-HP-ProLiant-SPP-2015-10-0-released" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/08/HP-ProLiant-SPP-2015-10-0-released/">HP ProLiant SPP 2015.10.0 released</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/10/08/HP-ProLiant-SPP-2015-10-0-released/" class="article-date">
  <time datetime="2015-10-07T22:59:00.000Z" itemprop="datePublished">2015-10-08</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>HP has released the new ProLiant SPP for October 2015.</p>
<p><a href="http://h17007.www1.hp.com/us/en/enterprise/servers/products/service_pack/spp/index.aspx" target="_blank" rel="external">http://h17007.www1.hp.com/us/en/enterprise/servers/products/service_pack/spp/index.aspx</a></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hp/">hp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/patches/">patches</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spp/">spp</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Considerations-using-MessageOps-Exchange-Migrator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/18/Considerations-using-MessageOps-Exchange-Migrator/">Considerations using MessageOps Exchange Migrator</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/06/18/Considerations-using-MessageOps-Exchange-Migrator/" class="article-date">
  <time datetime="2015-06-18T03:32:00.000Z" itemprop="datePublished">2015-06-18</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve been using MessageOps Exchange Migrator for a while now and while it is an amzing product, it isn’t without its quirks. Here are some I came across whilst migrating a small org (80 users) to Office365</p>
<ol>
<li>Make sure that the account you’re migrating isn’t disabled. If it is disabled, it doesn’t show up in the source mailbox list.</li>
<li>Ensure the mailbox isn’t hidden from the GAL. If it is, the migration will fail with a <code>MAIL_E_NAMEN</code> error and then <code>WSAECONNRESET</code>.</li>
<li>Ensure you have proper rights on the mailbox you are migrating from.</li>
<li>Ensure the mailbox you are migrating to has an Exchange license assigned. This can be E1, E2, E3, whatever.</li>
<li>If you change change any permissions or disable/enable accounts, hit back in the tool and let it rescan everything. This saves you restarting the app and having to type all your credentials again.</li>
</ol>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/office365/">office365</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-BitLocker-AD-ACE-s" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/04/BitLocker-AD-ACE-s/">BitLocker AD ACE&#39;s</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/06/04/BitLocker-AD-ACE-s/" class="article-date">
  <time datetime="2015-06-04T05:27:00.000Z" itemprop="datePublished">2015-06-04</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>When setting up BitLocker for interoperability with Active Directory, Microsoft gets you to run a VBS script to add an Access Control Entity (<a href="https://technet.microsoft.com/en-us/library/dd875529%28v=ws.10%29.aspx" target="_blank" rel="external">https://technet.microsoft.com/en-us/library/dd875529%28v=ws.10%29.aspx</a>). Unfortunately the script didn’t work for me, so I rewrote it in PowerShell.</p>
<script src="https://gist.github.com/jacobludriks/0bd728f35570a63b7dbf.js"></script>

<p>Use with <code>.\BitLocker-ACE.ps1 -Read</code> to check if the ACE is already there and <code>.\BitLocker-ACE.ps1 -Write</code> to create the ACE.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/activedirectory/">activedirectory</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bitlocker/">bitlocker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Trying-out-Docker-with-VMWare-Photon-and-Docker-CLI-for-Windows" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/04/23/Trying-out-Docker-with-VMWare-Photon-and-Docker-CLI-for-Windows/">Trying out Docker with VMWare Photon and Docker CLI for Windows</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2015/04/23/Trying-out-Docker-with-VMWare-Photon-and-Docker-CLI-for-Windows/" class="article-date">
  <time datetime="2015-04-23T06:30:00.000Z" itemprop="datePublished">2015-04-23</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>VMWare released “Photon” earlier this week, which is a lightweight Linux OS for hosting Docker containers. It’s amazingly slim like CoreOS and deploys in a matter of seconds. I gave it a spin today and it worked pretty well. Installing it on vSphere was pretty straightforward following <a href="https://vmware.github.io/photon/assets/files/getting_started_with_photon_on_vsphere.pdf" target="_blank" rel="external">documentation</a> on the Photon GitHub site. Once it was installed, I needed to make a few changes to get it working smoothly.</p>
<h4 id="Setting-the-proxy"><a href="#Setting-the-proxy" class="headerlink" title="Setting the proxy"></a>Setting the proxy</h4><p>If your environment uses a proxy to connect to the internet, continue with this section. If not, skip.</p>
<p>First, create a new directory to store the extra configuration.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir /etc/systemd/system/docker.service.d</div></pre></td></tr></table></figure>
<p>Next, create a <code>http-proxy.conf</code> file in the directory and edit it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">touch /etc/systemd/system/docker.service.d/http-proxy.conf</div><div class="line">nano /etc/systemd/system/docker.service.d/http-proxy.conf</div></pre></td></tr></table></figure>
<p>Add the following information to the file (substituting where necessary) and save with <code>Ctrl + X</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[Service]</div><div class="line">Environment=&quot;HTTP_PROXY=http://username:password@proxy.example.com:8080/&quot;</div></pre></td></tr></table></figure>
<p>Reload the <code>systemd</code> daemon and restart Docker.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl daemon-reload</div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure>
<p>Docker now has access to the internet.</p>
<h4 id="Allow-Docker-connection-via-TCP"><a href="#Allow-Docker-connection-via-TCP" class="headerlink" title="Allow Docker connection via TCP"></a>Allow Docker connection via TCP</h4><p>By default, Docker only allows connection through UNIX sockets. Since we will be controlling it via the Windows client, we need TCP access.</p>
<p>Open up the Docker service file in nano</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano /etc/systemd/system/multi-user.target.wants/docker.service</div></pre></td></tr></table></figure>
<p>Edit the <code>Service -&gt; ExecStart</code> line to allow TCP connections by changing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecStart=/bin/docker -d -s overlay</div></pre></td></tr></table></figure>
<p>to</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ExecStart=/bin/docker -d -s overlay -H tcp://0.0.0.0:2375</div></pre></td></tr></table></figure>
<p>Reload the <code>systemd</code> daemon and restart Docker.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl daemon-reload</div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure>
<h4 id="Upgrade-the-Docker-binary"><a href="#Upgrade-the-Docker-binary" class="headerlink" title="Upgrade the Docker binary"></a>Upgrade the Docker binary</h4><p>Photon comes with Docker 1.5.0 but unfortunately the Windows client only works with 1.6.0 and above.</p>
<p>If you are using a corporate proxy, you will first need to set the <code>http_proxy</code> environmental variable so <code>wget</code> works</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export https_proxy=&quot;http://username:password@proxy.example.com:8080/&quot;</div></pre></td></tr></table></figure>
<p>Download the Docker 1.6.0 binary</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://get.docker.com/builds/Linux/x86_64/docker-1.6.0</div></pre></td></tr></table></figure>
<p>Move the binary to <code>/bin/</code> and mark it as executable</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">systemctl stop docker</div><div class="line">rm -r /bin/docker</div><div class="line">mv docker-1.6.0 /bin/docker</div><div class="line">chmod +x /bin/docker</div><div class="line">systemctl start docker</div></pre></td></tr></table></figure>
<p>You will now have Docker 1.6.0 running.</p>
<h4 id="Connecting-from-Windows"><a href="#Connecting-from-Windows" class="headerlink" title="Connecting from Windows"></a>Connecting from Windows</h4><p>Download Docker 1.6.0 for Windows from Docker.com - <a href="https://get.docker.com/builds/Windows/i386/docker-1.6.0.exe" target="_blank" rel="external">32-bit</a> or <a href="https://get.docker.com/builds/Windows/x86_64/docker-1.6.0.exe" target="_blank" rel="external">64-bit</a> and open PowerShell in that directory. At this point I recommend renaming the file to <code>docker.exe</code>.</p>
<p>To connect to the Photon host, run the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.\docker.exe -H=tcp://photon.ip.address.here:2375 info</div></pre></td></tr></table></figure>
<p>This will show information about the Docker host like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Containers: 12</div><div class="line">Images: 49</div><div class="line">Storage Driver: overlay</div><div class="line"> Backing Filesystem: extfs</div><div class="line">Execution Driver: native-0.2</div><div class="line">Kernel Version: 3.19.2</div><div class="line">Operating System: &lt;unknown&gt;</div><div class="line">CPUs: 2</div><div class="line">Total Memory: 489.7 MiB</div><div class="line">Name: bvdocker1</div><div class="line">ID: &lt;id here&gt;</div></pre></td></tr></table></figure>
<p>You are now connected!</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/photon/">photon</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows/">windows</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
      </nav>
    </section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Jacob Ludriks&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>



<script src="/js/script.js"></script>
  </div>
</body>
</html>