
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Jacob Ludriks">
    <title>Archives: 2014 - Jacob Ludriks</title>
    <meta name="author" content="Jacob Ludriks">
    
    
    
    <meta property="og:type" content="blog">
<meta property="og:title" content="Jacob Ludriks">
<meta property="og:url" content="http://jacob.ludriks.com/archives/2014/page/3/index.html">
<meta property="og:site_name" content="Jacob Ludriks">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jacob Ludriks">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Jacob Ludriks</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/05/05/Manipulating-SDDL-s-through-PowerShell/">
                            Manipulating SDDL&#39;s through PowerShell
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-05-05T12:43:00+10:00">
	
		    May 05, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I manage security for service accounts through access with least privilege. Monitoring with PRTG however means that most of the WMI sensors need local Administrator access, which I’m not too happy about. One such situation is if you need to access the state of running services. To get around this, use the script below.</p>
<script src="https://gist.github.com/jacobludriks/6306afa2ad7949912d4f.js"></script>


<p>One example:</p>
<p><code>sddlset.ps1 -Username &quot;domain\monitoring&quot; -Service w3svc -Rights Read -Computer webserver</code></p>
<p>This will then resolve the SID for the user, add it to the SDDL with necessary permissions and then spit out the result. To allow any access at all you will first need to give the user permissions on <code>scmanager</code>, so run <code>sddlset.ps1 -Username &quot;domain\monitoring&quot; -Service scmanager -Rights Read -Computer webserver</code>.</p>
<p><strong>Edit 12/02/2015</strong>: Added help function to script, added ability to perform remotely.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/05/05/Manipulating-SDDL-s-through-PowerShell/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/04/28/TokenMungingException-in-Exchange-OWA/">
                            TokenMungingException in Exchange OWA
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-04-28T13:48:00+10:00">
	
		    Apr 28, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I’ve been busily rolling out Exchange 2013 SP1 at work and I’ve finally gotten to the stage where I can start migrating mailboxes over. Lo and behold, the fourth mailbox moved over had a strange issue whilst trying to access OWA:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">something went wrong</div><div class="line"></div><div class="line">Sorry, we can&apos;t get that information right now. Please try again later. If the problem persists, contact your helpdesk.</div><div class="line"></div><div class="line">X-OWA-Error: Microsoft.Exchange.Security.Authentication.TokenMungingException</div><div class="line">X-OWA-Version: 15.0.847.32</div><div class="line">X-FEServer: MAIL2013-1</div><div class="line">X-BEServer: Mail2013-2</div><div class="line">Date: 28/04/2014 11:35:42 AM</div></pre></td></tr></table></figure>
<p>It turns out that some users had a “LinkedMasterAccount” attribute set to “NT AUTHORITY\SELF” that didn’t need to be. The script to check all users with this attribute set:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Get-User -ResultSize unlimited | where &#123;$_.linkedmasteraccount -eq &quot;NT AUTHORITY\SELF&quot; -and $_.recipienttypedetails -ne &quot;RoomMailbox&quot; -and $_.recipienttypedetails -ne &quot;Equipmentmailbox&quot; -and $_.recipienttypedetails -ne &quot;DiscoveryMailbox&quot;&#125; | select name | ft</div></pre></td></tr></table></figure>
<p>This will spit out all accounts that aren’t room, equipment or discovery mailboxes with the LinkedMasterAccount set to “NT AUTHORITY\SELF”. From there, you can change it to $null with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Set-User -Identity &lt;user&gt; -LinkedMasterAccount $null</div></pre></td></tr></table></figure>
<p>After setting this the user was able to log in.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/04/28/TokenMungingException-in-Exchange-OWA/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/04/24/elasticsearch-trim/">
                            elasticsearch-trim
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-04-24T15:47:00+10:00">
	
		    Apr 24, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I got sick of having to trim my Logstash indices in Elasticsearch manually, so I created a PowerShell script and set it as a scheduled task. By default it keeps the last 60 days.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#Replace with the URL of your Elasticsearch instance</div><div class="line">$url = &quot;http://elasticsearch:9200/&quot;</div><div class="line">#Replace with how many days you want to keep, minus one (below means 60)</div><div class="line">$i = 59</div><div class="line">$request = (Invoke-WebRequest -Uri $url/_aliases).content | ConvertFrom-Json</div><div class="line">$indices = $request | Get-Member | where &#123;$_.name -like &quot;logstash*&quot;&#125; | select name | sort name -Descending</div><div class="line">$count = $indices.count</div><div class="line">do &#123;</div><div class="line">    $var = $indices[$i].name</div><div class="line">    Invoke-WebRequest -Uri $url/$var/ -Method Delete</div><div class="line">    $i++</div><div class="line">&#125;</div><div class="line">until ($i -eq $count)</div></pre></td></tr></table></figure>
<p>Works well, but it doesn’t send a report or anything that it has been done.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/04/24/elasticsearch-trim/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        <li class="pagination-prev">
            
                <a class="btn btn--default btn--small" href="/archives/2014/page/2/">
            
                <i class="fa fa-angle-left text-base icon-mr"></i>
                    <span>NEWER POSTS</span>
            </a>
        </li>
        
        
        <li class="pagination-number">page 3 of 3</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 Jacob Ludriks. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Jacob Ludriks</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js"></script>
<!--SCRIPTS END-->



</html>
