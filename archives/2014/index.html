
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Jacob Ludriks">
    <title>Archives: 2014 - Jacob Ludriks</title>
    <meta name="author" content="Jacob Ludriks">
    
    
    
    <meta property="og:type" content="blog">
<meta property="og:title" content="Jacob Ludriks">
<meta property="og:url" content="http://jacob.ludriks.com/archives/2014/index.html">
<meta property="og:site_name" content="Jacob Ludriks">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jacob Ludriks">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-nuvue6sithwirecbhvw3dkaobiojqvtadsnhguwi7k04xklybw5djl1smadp.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Jacob Ludriks</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/11/27/Upgrading-HBA-Firmware-and-Drivers-on-HP-ESXi-Hosts/">
                            Upgrading HBA Firmware and Drivers on HP ESXi Hosts
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-11-27T22:37:00+11:00">
	
		    Nov 27, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I’m guilty of only updating firmware and drivers on my devices when problems arise. I’m sure most of us do this. Bad practice! The guide in this post shows how to update a ProLiant system (blade, pedestal or rackmount) with the HP SPP and latest drivers.</p>
<p><strong>BEFORE YOU DO ANYTHING</strong>: Put the host in maintenance mode and move the virtual machines off! This probably doesn’t need to be said, but hey.</p>
<p><a href="http://vibsdepot.hp.com/" target="_blank" rel="external">HP VibsDepot</a> is a great resource for the currently supported firmware and driver recipe for ESXi as well as links to the required files. The most current support recipe document is located at <a href="http://vibsdepot.hp.com/hpq/recipes/HP-VMware-Recipe.pdf" target="_blank" rel="external">http://vibsdepot.hp.com/hpq/recipes/HP-VMware-Recipe.pdf</a> (pdf). First things first; you need to get the model of your HBA and which driver it uses. You can do this by connecting to the host with SSH.</p>
<p>If you don’t have SSH enabled, press F2 at the ESXi screen and login with the root credentials. Then, go down to <code>Troubleshooting Options</code> and select <code>Enable SSH</code>. You can then exit out of the menu by hitting the escape key a few times.</p>
<p>Open up your SSH client and connect to the host, then:</p>
<p><code># ls /proc/scsi</code></p>
<p>You will see possibly two or three devices. My HBA’s are Emulex branded, so mine shows as <code>lpfc820</code>.</p>
<p><code># cat /proc/scsi/lpfc820/1</code></p>
<p>I used tab complete after the final slash to get the HBA number put in automatically. The info received:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Emulex OneConnect FCoE SCSI 8.2.1.90.28</div><div class="line">HP FlexFabric 10Gb 2-port 554FLB Adapter on PCI bus 0000:04 device 02 irq 184 Logical Link Speed: 4000 Mbps</div><div class="line">BoardNum: 0</div><div class="line">ESX Adapter: vmhba0</div><div class="line">Firmware Version: 4.1.450.16</div><div class="line">Portname: 50:06:0b:00:00:c2:62:10   Nodename: 50:06:0b:00:00:c2:62:11</div><div class="line">SLI Rev: 4</div><div class="line">    MQ: Enabled with 0x2 queues</div><div class="line">    NPIV Supported: VPIs max 255  VPIs used 0</div><div class="line">    RPIs max 1024  RPIs used 4   IOCBs inuse 0  IOCB max 8   txq cnt 0  txq max 0  txcmplq 0</div><div class="line">    Vport List:</div><div class="line">Link Up - Ready:</div><div class="line">    PortID 0x10e05</div><div class="line">    Fabric</div><div class="line">    Current speed 10G</div><div class="line">Port Discovered Nodes: Count 2</div><div class="line">t0000 DID 010c00 WWPN 50:01:43:80:02:5d:bb:e8 WWNN 50:01:43:80:02:5d:bb:e0 qdepth 8192 max 2 active 0 busy 0</div><div class="line">t0001 DID 010d00 WWPN 50:01:43:80:02:5d:bb:ec WWNN 50:01:43:80:02:5d:bb:e0 qdepth 8192 max 2 active 0 busy 0</div></pre></td></tr></table></figure>
<p>The most relevant information above is that the driver version currently installed is <code>8.2.1.90.28</code>, the firmware version is <code>4.1.450.16</code> and that the card is a <code>HP FlexFabric 10Gb 2-port 554FLB</code>. Within the recipe PDF linked to earlier, I can see that the most recent driver version is <code>8.2.4.141.55</code> and the most recent firmware version is <code>4.2.401.2215</code>, so I’m behind quite a few versions.</p>
<p>From the recipe PDF, click on the required driver link for your card, which will take you to the VMWare website. A zip file will be downloaded, and inside is another zip file with the word <strong>offline_bundle</strong> in its filename. This is the driver package we need. Set it aside for the next step. For the firmware, download the latest <a href="http://h18004.www1.hp.com/products/servers/service_packs/en/index.html" target="_blank" rel="external">Service Pack for ProLiant</a>. It’s a big ISO that includes firmware updates for all ProLiant servers and it works quite well. It’s normally updated every 3-4 months.</p>
<p>If you’re like me and have some old blades in your environment (like the BL460c G1) with iLO 2, you might find the virtual media function a bit flaky when you mount the SPP ISO. As a workaround, use the <a href="http://h20565.www2.hp.com/portal/site/hpsc/template.PAGE/public/psi/swdDetails/?javax.portlet.begCacheTok=com.vignette.cachetoken&amp;javax.portlet.endCacheTok=com.vignette.cachetoken&amp;javax.portlet.prp_bd9b6997fbc7fc515f4cf4626f5c8d01=wsrp-navigationalState%3Didx%3D%7CswItem%3DMTX_40e268a99cc243a299352b7b20%7CitemLocale%3D%7Cmode%3D%7Caction%3DdriverDocument&amp;javax.portlet.tpst=bd9b6997fbc7fc515f4cf4626f5c8d01&amp;ac.admitted=1374043405767.876444892.492883150" target="_blank" rel="external">HP USB Key Utility</a> (version 1.7!) to put the SPP on a USB drive and use a direct connection to the blade to boot. Don’t forget, the boot menu key is <strong>F11</strong>.</p>
<p>There is some excellent documentation available on the <a href="http://h18004.www1.hp.com/products/servers/service_packs/en/index.html" target="_blank" rel="external">HP SPP portal</a> for how to use the SPP. The latest version from when this post was written is <a href="http://bizsupport2.austin.hp.com/bc/docs/support/SupportManual/c03673114/c03673114.pdf" target="_blank" rel="external">here</a>.</p>
<p>Use an SCP client (I use <a href="http://winscp.net/" target="_blank" rel="external">WinSCP</a>) to transfer the offline_bundle driver to a temporary directory on the host (I use <code>/var/log/vmware/</code>). Then, SSH in to the host and execute the following command:</p>
<p><code># esxcli software vib install --maintenance-mode --no-sig-check -d /var/log/vmware/name_of_offline_bundle.zip</code></p>
<p>Be aware that this can take quite a while, so don’t worry if there is still no output after 10 minutes. You should get an output similar to:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Installation Result</div><div class="line">    Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.</div><div class="line">    Reboot Required: true</div><div class="line">    VIBs Installed: Emulex_bootbank_scsi-lpfc820_8.2.4.151.65-1OEM.500.0.0.472560</div><div class="line">    VIBs Removed: Emulex_bootbank_scsi-lpfc820_8.2.4.141.55-1OEM.500.0.0.472560</div><div class="line">    VIBs Skipped:</div></pre></td></tr></table></figure>
<p>Issue a reboot to the system with <code>reboot</code>. Once it comes back up, take it out of maintenance mode. Done!</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/11/27/Upgrading-HBA-Firmware-and-Drivers-on-HP-ESXi-Hosts/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/11/27/Lost-Management-Interface-on-an-ESXi-Host/">
                            Lost Management Interface on an ESXi Host
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-11-27T22:32:00+11:00">
	
		    Nov 27, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>A hosts management network interface somehow dropped off the network this afternoon. Fortunately I was still able to get in through iLO. It always pays to have an out-of-band interface active!</p>
<img src="/2014/11/27/Lost-Management-Interface-on-an-ESXi-Host/esxi-no-mgmt.png" alt="esxi-no-mgmt.png" title="">
<p>From the DCUI screen, press <code>Alt + F1</code>. This will bring up the login screen. Log in as root then type <code>esxcli network ip interface list</code>. You will get an output similar to the one below.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">vmk2</div><div class="line">    Name: vmk2</div><div class="line">    MAC Address: 00:50:56:79:0c:de</div><div class="line">    Enabled: true</div><div class="line">    Portset: DvsPortset-0</div><div class="line">    Portgroup: N/A</div><div class="line">    VDS Name: dvSwitch-vMotion</div><div class="line">    VDS UUID: 0c 7d 1a 50 93 7b 86 3f-76 f8 74 80 73 7c 3d 0f</div><div class="line">    VDS Port: 101</div><div class="line">    VDS Connection: 1952632411</div><div class="line">    MTU: 1500</div><div class="line">    TSO MSS: 65535</div><div class="line">    Port ID: 33554436</div><div class="line"></div><div class="line">vmk0</div><div class="line">    Name: vmk0</div><div class="line">    MAC Address: 00:1c:c4:bd:d6:ee</div><div class="line">    Enabled: false</div><div class="line">    Portset: DvsPortset-2</div><div class="line">    Portgroup: N/A</div><div class="line">    VDS Name: dvSwitch</div><div class="line">    VDS UUID: 10 e1 1a 50 b1 22 19 a1-d4 33 10 dc 72 9a 92 db</div><div class="line">    VDS Port: 151</div><div class="line">    VDS Connection: 660732515</div><div class="line">    MTU: 1500</div><div class="line">    TSO MSS: 65535</div><div class="line">    Port ID: 67108871</div></pre></td></tr></table></figure>
<p>Fortunately mine was an easy issue to solve; vmk0 had <code>Enabled: false</code>. An easy fix: <code>esxcli network ip interface set -i vmk0 -e true</code></p>
<p>After this I was able to reconnect to the host from within vCenter.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/11/27/Lost-Management-Interface-on-an-ESXi-Host/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/11/27/Meeting-Room-Utilization/">
                            Meeting Room Utilization
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-11-27T22:30:00+11:00">
	
		    Nov 27, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I had a request from a user to find out the meeting room utilization across our head office, but unfortunately I couldn’t find an easy way to do this with Exchange 2010 cmdlets. Here are some instructions to do so with COM objects, PowerShell and Excel.</p>
<p>First create a mailbox that will have the meeting room rights assigned to it, then grant the user access to the required mailboxes so that they show in Outlook:</p>
<p><code>Get-Mailbox meetingroomprefix* | Add-MailboxPermission -AccessRights FullAccess -User temporarymailbox</code></p>
<p>Open Outlook and add the meeting room mailboxes, then run the PowerShell script below with the appropriate date range. Mine shows the last financial year.</p>
<script src="https://gist.github.com/jacobludriks/8cdd5c2a74d70fd35b3b.js"></script>

<p>Next, open the CSV output file in Excel then:</p>
<ol>
<li>Create new sheet called Report</li>
<li>Insert a pivot table containing all the data from the raw data sheet</li>
<li>Drag “MeetingRoom” to Rows</li>
<li>Drag “Duration” to Values. Edit the field settings to be “Count” and rename to “Number of Meetings”</li>
<li>Drag “Duration” to Values. Edit the field settings to be “Sum” and rename to “Total Duration”</li>
<li>Create two new fields – one with the amount of work weeks per year (48.775 for mine) and the amount of hours per week (40 for mine).</li>
<li>Create a new table for utilization percentages. Put the formula as <code>=C5/($E$5*$E$9*60)</code>.</li>
</ol>
<img src="/2014/11/27/Meeting-Room-Utilization/meetingroom.png" alt="meetingroom.png" title="">
                    
                        
                    
                    
                        <p>
                            <a href="/2014/11/27/Meeting-Room-Utilization/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/11/27/Change-SMTP-settings-on-Xerox-machines-with-PowerShell/">
                            Change SMTP settings on Xerox machines with PowerShell
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-11-27T14:36:00+11:00">
	
		    Nov 27, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I got really sick of changing SMTP settings on Xerox machines manually, so I made a PowerShell script to make it easier. The script can also pull a list of printers from a print server and work from that.</p>
<script src="https://gist.github.com/jacobludriks/4bcbcc9cba061f1e09a7.js"></script>

<p>Just change the variables up the top and run the script.</p>
<p>It could be further optimized with PowerShell workflows so it works on each concurrently, but I was lazy.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/11/27/Change-SMTP-settings-on-Xerox-machines-with-PowerShell/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/08/14/Adobe-FTP-is-slow/">
                            Adobe FTP is slow!
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-08-14T14:41:00+10:00">
	
		    Aug 14, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>Not sure if you have tried to download from adobe FTP site lately, however it is exceedingly slow (23kbps slow!). I have this afternoon, just worked out a small hack that makes it a lot faster… so far it seems to work (for the three adobe reader patches I’ve tried anyway).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1. Find the file on ftp://ftp.adobe.com/</div><div class="line">2. Copy the url of the file (including the exe, zip, etc) that you want to download.</div><div class="line">3. Replace the first part of the URL (ftp://ftp.adobe.com/) with http://ardownload.adobe.com/</div><div class="line">E.g. ftp://ftp.adobe.com/pub/adobe/reader/win/11.x/11.0.07/misc/AdbeRdrUpd11007_incr.msp becomes http://ardownload.adobe.com/pub/adobe/reader/win/11.x/11.0.07/misc/AdbeRdrUpd11007_incr.msp </div><div class="line">5. Enjoy the much faster download speeds!</div></pre></td></tr></table></figure>
                    
                        
                    
                    
                        <p>
                            <a href="/2014/08/14/Adobe-FTP-is-slow/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/08/14/Citrix-error-number-2320/">
                            Citrix error number 2320
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-08-14T14:38:00+10:00">
	
		    Aug 14, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I found a weird error in Citrix the other day.</p>
<img src="/2014/08/14/Citrix-error-number-2320/citrix_online.png" alt="citrix_online.png" title="">
<p>The fix:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Citrix\ICA Client\Engine\Lockdown Profiles\All Regions</div><div class="line"></div><div class="line">Change the DWORD value for EnableLockdown from 1 to 0.</div><div class="line"></div><div class="line">Close Registry Editor and try to launch the application again.</div></pre></td></tr></table></figure>
                    
                        
                    
                    
                        <p>
                            <a href="/2014/08/14/Citrix-error-number-2320/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/07/31/Enable-Disable-IE-on-Server-2008R2/">
                            Enable/Disable IE on Server 2008R2
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-07-31T14:05:00+10:00">
	
		    Jul 31, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>To install (requires a restart):</p>
<p><code>dism /online /Enable-Feature /FeatureName:Internet-Explorer-Optional-amd64</code></p>
<p>To uninstall (doesn’t require a restart):</p>
<p><code>dism /online /Disable-Feature /FeatureName:Internet-Explorer-Optional-amd64</code></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/07/31/Enable-Disable-IE-on-Server-2008R2/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/07/24/Sign-PSScript/">
                            Sign-PSScript
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-07-24T10:28:00+10:00">
	
		    Jul 24, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>Just a quick function to sign PowerShell scripts with a code-signing certificate. Very useful for deploying scripts in a domain to all computers without changing the execution policy.</p>
<script src="https://gist.github.com/jacobludriks/efc67998d8e058af76e7.js"></script>

<p>Throw it in your <code>$profile</code>, reload, run with <code>Sign-PSScript -Script c:\path\to\script.ps1</code>.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/07/24/Sign-PSScript/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/07/23/ERROR-FILE-SYSTEM-LIMITATION-whilst-using-Windows-deduplication-with-Veeam/">
                            ERROR_FILE_SYSTEM_LIMITATION whilst using Windows deduplication with Veeam
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-07-23T13:12:00+10:00">
	
		    Jul 23, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>This is a possible scenario that can happen with Veeam and Server 2012 deduplication:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">You cannot write to a file anymore and you get the error &quot;ERROR_FILE_SYSTEM_LIMITATION&quot;. There is still plenty of space left on the volume however this file can&apos;t grow. This is a big issue wince you use rollback chains in Veeam.</div></pre></td></tr></table></figure>
<p>To fix this unfortunately you need to start a whole new chain on a new volume. When formatting the volume, use <code>format drive: /fs:ntfs /v:volumelabel /Q /L</code>. The <code>/Q</code> switch does a quick format, and the <code>/L</code> switch enables large-size file records.</p>
<p>Unfortunately this switch isn’t very well documented - it’s not even in the <code>format.exe</code> <a href="http://technet.microsoft.com/en-us/library/cc730730.aspx" target="_blank" rel="external">knowledgebase article</a>. You can however get some information from <code>format /?</code> in command prompt.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/L	NTFS Only: Use large size file records.</div><div class="line">	By default, the volume will be formatted with small size file records.</div></pre></td></tr></table></figure>
<p>A Microsoft primer on how NTFS works (<a href="http://technet.microsoft.com/en-us/library/cc781134(v=ws.10" target="_blank" rel="external">Source</a>.aspx)) sheds some light but it doesn’t show you the limit of setting large-size file records.</p>
<p>Reference: <a href="http://support.microsoft.com/kb/2891967" target="_blank" rel="external">Microsoft KB2891967</a></p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/07/23/ERROR-FILE-SYSTEM-LIMITATION-whilst-using-Windows-deduplication-with-Veeam/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2014/07/10/IIS-logging-to-the-ELK-stack/">
                            IIS logging to the ELK stack
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2014-07-10T12:39:00+10:00">
	
		    Jul 10, 2014
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>Our Exchange 2013 servers had a near-meltdown last week due to no free disk space on the C: drive, which would have been pretty catastrophic if we didn’t have the appropriate monitoring in place. After some investigation, I found that the IIS instances on the boxes had been happily logging away since we implemented them and the log directories had grown to a gigantic 40gb each. Not happy with just deleting them, I figured I would ship them to our logging server and delete them from the servers themselves.</p>
<p>I have been using the ELK stack (Elasticsearch, Logstash, Kibana) for about a year now and it’s been great. Logs are searchable and if any issues arise we can quickly pinpoint exactly what has been happening over a number of devices over that time, such as switches, wireless access points, firewalls, Windows servers etc.</p>
<h4 id="Logging-input"><a href="#Logging-input" class="headerlink" title="Logging input"></a>Logging input</h4><p>First, you will need to install a log shipper on the Windows server. I went with <a href="http://nxlog.org/" target="_blank" rel="external">nxlog</a> as it has good support and it seems to be what everybody else uses on Windows. As a bonus, it doesn’t require Java to be installed unlike Logstash. Download the installer from the nxlog website and install it to the machine. After it is installed, open <code>C:\Program Files (x86)\nxlog\conf\nxlog.conf</code> and put the following in:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;Input iis_1&gt;</div><div class="line">      Module	im_file</div><div class="line">      File	&quot;C:\inetpub\logs\LogFiles\W3SVC1\u_ex*.log&quot;</div><div class="line">    ReadFromLast True</div><div class="line">    SavePos True</div><div class="line">    Exec	if $raw_event =~ /^#/ drop();</div><div class="line">&lt;/Input&gt;</div><div class="line">&lt;Input iis_2&gt;</div><div class="line">      Module	im_file</div><div class="line">      File	&quot;C:\inetpub\logs\LogFiles\W3SVC2\u_ex*.log&quot;</div><div class="line">    ReadFromLast True</div><div class="line">    SavePos True</div><div class="line">    Exec	if $raw_event =~ /^#/ drop();</div><div class="line">&lt;/Input&gt;</div><div class="line">&lt;Output out_iis&gt;</div><div class="line">    Module  om_tcp</div><div class="line">    Host    &lt;LOGSTASH_IP&gt;</div><div class="line">    Port    3516</div><div class="line">	OutputType	LineBased</div><div class="line">&lt;/Output&gt;</div><div class="line">&lt;Route 1&gt;</div><div class="line">	Path	iis_1, iis_2 =&gt; out_iis</div><div class="line">&lt;/Route&gt;</div></pre></td></tr></table></figure>
<p>Make sure you replace <code>&lt;LOGSTASH_IP&gt;</code> with your Logstash servers’ IP address.</p>
<h4 id="Logging-Output"><a href="#Logging-Output" class="headerlink" title="Logging Output"></a>Logging Output</h4><p>I won’t go in to deploying the ELK stack as there are a tonne of guides available. Make sure it all works before proceeding below.</p>
<p>On the Logstash instance in your <code>logstash.conf</code>, place the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">input &#123;</div><div class="line">      tcp &#123;</div><div class="line">          	type =&gt; &quot;iis&quot;</div><div class="line">          	port =&gt; 3516</div><div class="line">          	host =&gt; &quot;10.100.21.156&quot;</div><div class="line">      &#125;</div><div class="line">&#125;</div><div class="line">filter &#123;</div><div class="line">	if [type] == &quot;iis&quot; &#123;</div><div class="line">    	grok &#123;</div><div class="line">        	match =&gt; [&quot;@message&quot;, &quot;%&#123;TIMESTAMP_ISO8601:timestamp&#125; %&#123;IPORHOST:hostip&#125; %&#123;WORD:method&#125; %&#123;URIPATH:page&#125; %&#123;NOTSPACE:query&#125; %&#123;NUMBER:port&#125; %&#123;NOTSPACE:username&#125; %&#123;IPORHOST:clientip&#125; %&#123;NOTSPACE:useragent&#125; %&#123;NOTSPACE:referrer&#125; %&#123;NUMBER:response&#125; %&#123;NUMBER:subresponse&#125; %&#123;NUMBER:scstatus&#125; %&#123;NUMBER:timetaken&#125;&quot;]</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">	elasticsearch_http &#123;</div><div class="line">    	host =&gt; &quot;&lt;ELASTICSEARCH_IP&gt;&quot;</div><div class="line">        port =&gt; &quot;9200&quot;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Again, make sure you replace <code>&lt;ELASTICSEARCH_IP&gt;</code> with your Elasticsearch servers’ IP address.</p>
<p>After you have done all this, start nxlog on your Windows server with <code>Start-Service nxlog</code> in a PowerShell prompt and watch the logs pour in to your ElasticSearch instance.</p>
<img src="/2014/07/10/IIS-logging-to-the-ELK-stack/2014-07-10_12-33-54.png" alt="2014-07-10_12-33-54.png" title="">
<h4 id="Truncating-IIS-logs"><a href="#Truncating-IIS-logs" class="headerlink" title="Truncating IIS logs"></a>Truncating IIS logs</h4><p>This part is easy. Just set up a scheduled task to run the following PowerShell command:</p>
<p><code>Get-ChildItem -Path C:\inetpub\logs\LogFiles -Recurse | ? {$_.PSIsContainer -eq $false -and $_.lastwritetime -lt (get-date).adddays(-15)} | Remove-Item -Force</code></p>
<p>This may vary if you have chaned the logging directory and if you want to keep the files longer than 5 days.</p>

                    
                        
                    
                    
                        <p>
                            <a href="/2014/07/10/IIS-logging-to-the-ELK-stack/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/archives/2014/page/2/">
                    <span>OLDER POSTS</span>
                <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
        </li>
        
        <li class="pagination-number">page 1 of 3</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 Jacob Ludriks. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Jacob Ludriks</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script-i4qo6jx6jji9fg0dftpya6ivemizsbow4fhow76d8dwpm7m1wbvi378ssumx.min.js"></script>
<!--SCRIPTS END-->



</html>
