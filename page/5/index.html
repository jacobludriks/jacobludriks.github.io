<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Jacob Ludriks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Jacob Ludriks">
<meta property="og:url" content="http://jacob.ludriks.com/page/5/index.html">
<meta property="og:site_name" content="Jacob Ludriks">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jacob Ludriks">
  
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jacob.ludriks.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer">
      <article id="post-Synology-update-URLs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/06/Synology-update-URLs/">Synology update URLs</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2014/05/06/Synology-update-URLs/" class="article-date">
  <time datetime="2014-05-06T05:09:00.000Z" itemprop="datePublished">2014-05-06</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>If you have a restrictive firewall, Synology devices need two URLs allowed outbound to update:</p>
<ul>
<li><code>download.synology.com</code></li>
<li><code>update.synology.com</code></li>
</ul>
<p>I couldn’t really find this information anywhere else, so here you go.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/synology/">synology</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Setting-WMI-permissions-for-PRTG" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/05/Setting-WMI-permissions-for-PRTG/">Setting WMI permissions for PRTG</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2014/05/05/Setting-WMI-permissions-for-PRTG/" class="article-date">
  <time datetime="2014-05-05T03:32:00.000Z" itemprop="datePublished">2014-05-05</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Setting permissions for PRTG to monitor WMI on systems is a bit of a chore. The script below sets the appropriate permissions for a lot of the WMI sensors in PRTG.</p>
<script src="https://gist.github.com/jacobludriks/2fa223ac279e0472df47.js"></script>

<p>Run by using <code>script.ps1 -Username &quot;domain\user&quot;</code></p>
<p>Please note that this needs ntrights.exe, which is included in the <a href="http://www.microsoft.com/en-us/download/details.aspx?id=17657" target="_blank" rel="external">Windows Server 2003 Resource Kit</a></p>
<p>I may look in to making this a group policy script in the future but for starters this will do. It saves around 3-5 minutes of time per server, depending how fast you can click.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/prtg/">prtg</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wmi/">wmi</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-Manipulating-SDDL-s-through-PowerShell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/05/Manipulating-SDDL-s-through-PowerShell/">Manipulating SDDL&#39;s through PowerShell</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2014/05/05/Manipulating-SDDL-s-through-PowerShell/" class="article-date">
  <time datetime="2014-05-05T02:43:00.000Z" itemprop="datePublished">2014-05-05</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>I manage security for service accounts through access with least privilege. Monitoring with PRTG however means that most of the WMI sensors need local Administrator access, which I’m not too happy about. One such situation is if you need to access the state of running services. To get around this, use the script below.</p>
<script src="https://gist.github.com/jacobludriks/6306afa2ad7949912d4f.js"></script>


<p>One example:</p>
<p><code>sddlset.ps1 -Username &quot;domain\monitoring&quot; -Service w3svc -Rights Read -Computer webserver</code></p>
<p>This will then resolve the SID for the user, add it to the SDDL with necessary permissions and then spit out the result. To allow any access at all you will first need to give the user permissions on <code>scmanager</code>, so run <code>sddlset.ps1 -Username &quot;domain\monitoring&quot; -Service scmanager -Rights Read -Computer webserver</code>.</p>
<p><strong>Edit 12/02/2015</strong>: Added help function to script, added ability to perform remotely.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sddl/">sddl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/services/">services</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wmi/">wmi</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-TokenMungingException-in-Exchange-OWA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/04/28/TokenMungingException-in-Exchange-OWA/">TokenMungingException in Exchange OWA</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2014/04/28/TokenMungingException-in-Exchange-OWA/" class="article-date">
  <time datetime="2014-04-28T03:48:00.000Z" itemprop="datePublished">2014-04-28</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve been busily rolling out Exchange 2013 SP1 at work and I’ve finally gotten to the stage where I can start migrating mailboxes over. Lo and behold, the fourth mailbox moved over had a strange issue whilst trying to access OWA:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">something went wrong</div><div class="line"></div><div class="line">Sorry, we can&apos;t get that information right now. Please try again later. If the problem persists, contact your helpdesk.</div><div class="line"></div><div class="line">X-OWA-Error: Microsoft.Exchange.Security.Authentication.TokenMungingException</div><div class="line">X-OWA-Version: 15.0.847.32</div><div class="line">X-FEServer: MAIL2013-1</div><div class="line">X-BEServer: Mail2013-2</div><div class="line">Date: 28/04/2014 11:35:42 AM</div></pre></td></tr></table></figure>
<p>It turns out that some users had a “LinkedMasterAccount” attribute set to “NT AUTHORITY\SELF” that didn’t need to be. The script to check all users with this attribute set:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Get-User -ResultSize unlimited | where &#123;$_.linkedmasteraccount -eq &quot;NT AUTHORITY\SELF&quot; -and $_.recipienttypedetails -ne &quot;RoomMailbox&quot; -and $_.recipienttypedetails -ne &quot;Equipmentmailbox&quot; -and $_.recipienttypedetails -ne &quot;DiscoveryMailbox&quot;&#125; | select name | ft</div></pre></td></tr></table></figure>
<p>This will spit out all accounts that aren’t room, equipment or discovery mailboxes with the LinkedMasterAccount set to “NT AUTHORITY\SELF”. From there, you can change it to $null with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Set-User -Identity &lt;user&gt; -LinkedMasterAccount $null</div></pre></td></tr></table></figure>
<p>After setting this the user was able to log in.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/exchange/">exchange</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <article id="post-elasticsearch-trim" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/04/24/elasticsearch-trim/">elasticsearch-trim</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2014/04/24/elasticsearch-trim/" class="article-date">
  <time datetime="2014-04-24T05:47:00.000Z" itemprop="datePublished">2014-04-24</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>I got sick of having to trim my Logstash indices in Elasticsearch manually, so I created a PowerShell script and set it as a scheduled task. By default it keeps the last 60 days.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#Replace with the URL of your Elasticsearch instance</div><div class="line">$url = &quot;http://elasticsearch:9200/&quot;</div><div class="line">#Replace with how many days you want to keep, minus one (below means 60)</div><div class="line">$i = 59</div><div class="line">$request = (Invoke-WebRequest -Uri $url/_aliases).content | ConvertFrom-Json</div><div class="line">$indices = $request | Get-Member | where &#123;$_.name -like &quot;logstash*&quot;&#125; | select name | sort name -Descending</div><div class="line">$count = $indices.count</div><div class="line">do &#123;</div><div class="line">    $var = $indices[$i].name</div><div class="line">    Invoke-WebRequest -Uri $url/$var/ -Method Delete</div><div class="line">    $i++</div><div class="line">&#125;</div><div class="line">until ($i -eq $count)</div></pre></td></tr></table></figure>
<p>Works well, but it doesn’t send a report or anything that it has been done.</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elk/">elk</a></li></ul>

      </footer>
    
  </div>
  
</article>


    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span>
      </nav>
    </section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Jacob Ludriks&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>



<script src="/js/script.js"></script>
  </div>
</body>
</html>